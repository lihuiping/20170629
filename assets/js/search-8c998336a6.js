function baseUrl(){return"http://my.shop.7cai.tv/"}function addHisRecord(e,a){var i=window.localStorage.getItem("id");a=a||10;var t=window.localStorage.getItem("hisRecord_str");if("object"==typeof t){var o=[];t=o.join("|"),window.localStorage.setItem("hisRecord_str",t)}if(o=t.split("|"),t||o.pop(),!e)return o;if(-1==o.indexOf(e+"&"+i))o.unshift(e+"&"+i),o.length>a&&o.pop();else{var r=o.indexOf(e+"&"+i);o.splice(r,1),o.unshift(e+"&"+i)}t=o.join("|"),window.localStorage.setItem("hisRecord_str",t)}function removeHisRecord(e){var a=window.localStorage.getItem("hisRecord_str"),i=a.split("|");a?"all"==e?i.splice(0,i.length):i.splice(e,1):i.pop(),a=i.join("|"),window.localStorage.setItem("hisRecord_str",a),renderData(i,"#listRecord")}function renderData(e,a){var i="",t=[];for(c in e){var o=e[c].split("&");i=i+o[0]+"|",t.push(o[1])}e=i.substr(0,i.length-1).split("|"),$(a).html('<li v-for="as in list" v-cloak><a @click="hrefNext(as.id)">{{as.text}}</a></li>');var r=[],s=[];for(c in e){var r={name:e[c],id:t[c]};s.push(r)}var n=[];for(var c in s)n.push({text:s[c].name,id:s[c].id});new Vue({el:a,data:{list:n},methods:{hrefNext:function(e){window.location.href="goods-detail.html?id="+e}}})}function hisRecord(){var e=addHisRecord();e.join()&&renderData(e,"#listRecord")}function listShow(){$("#listRecord a").length>0?($(".search-anys").hide(),$(".search-record").show()):($(".search-anys").show(),$(".search-record").hide())}var Cookie={setCookie:function(e,a,i){var t=e+"="+escape(a);if(i){if(i.expireDays){var o=new Date,r=24*i.expireDays*3600*1e3;o.setTime(o.getTime()+r),t+="; expires="+o.toGMTString()}i.path&&(t+=";path="+i.path),i.domain&&(t+=";domain="+i.domain),i.secure&&(t+=";true")}document.cookie=t},getCookie:function(e){for(var a=document.cookie.split(";"),i=0;i<a.length;i++){var t=a[i].split("=");if(t[0]==e)return unescape(t[1])}return""},delCookie:function(e){this.setCookie(e,"",{expireDays:-1})}};window.onload=function(){"1"==Cookie.getCookie("diffmaker")?($("#searchInput").val(""),Cookie.delCookie("diffmaker")):($("#searchInput").val(""),Cookie.setCookie("diffmaker","1",null),window.location.reload(!0))},$("#search-cancel").on("click",function(){window.history.go(-1)});var u=navigator.userAgent,isiOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);$("#searchInput").bind("keyup",function(){$.ajax({type:"GET",async:!1,url:baseUrl()+"index.php?r=search&m=index&keys="+$(this).val(),cache:!1,dataType:"json",success:function(e){var a=e,i=e.data.length,t=e.msg,o=$("#searchInput").val();if(0!==i&&""!==o){$(".search-list").html('<a v-for="ls in data" :data-id="ls.id" :href="getTitleHref(ls.id)"  v-cloak>{{ls.keys}}</a>');new Vue({el:".search-list",data:a,methods:{getTitleHref:function(e){return"goods-detail.html?id="+e}}});$(".search-none").hide(),$(".search-anys").hide()}"失败"==t&&($(".search-none").show(),$(".search-list a").hide()),""==o?(hisRecord(),$(".search-record").show(),$(".search-none").hide(),$(".search-list").empty(),""==$("#listRecord a").html()&&$("#listRecord a").css("border-top","none")):($(".search-record").hide(),$(".search-anys").hide())},error:function(e){layer.open({content:"数据错误",skin:"msg",time:1})}});$("#searchInput").val();$("#searchDel").show(),$("#searchDel").click(function(){listShow(),hisRecord(),$("#searchInput").val(""),$(".search-list").empty(),$(".search-none").hide(),$(".search-record").show()}),$("#searchInput").keyup(function(e){13==e.which&&(1==find?$.toast("请点击商品名查看详情"):$.toast("未找到商品"),e.preventDefault())})}),hisRecord(),listShow(),$(".search-list a").live("click",function(){var e=$(this).html(),a=$(this).attr("data-id");window.localStorage.setItem("id",a),addHisRecord(e),$("#searchInput").val("")}),$(".clear-record").on("click",function(){layer.open({content:"确定删除全部历史纪录？",btn:["确定","取消"],yes:function(e){removeHisRecord("all"),listShow(),$(".search-record").hide(),$(".search-anys").show(),layer.close(e)}}),$(".layui-m-anim-scale").addClass("searchAera"),$(".layui-m-layerbtn").addClass("searchTop"),$(".layui-m-layercont").addClass("searchConfirm"),$(".layui-m-layerbtn span[no]").addClass("searchCancel"),$(".layui-m-layerbtn span[yes]").addClass("ok")});