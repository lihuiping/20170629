function transformRequest(e){var a="";for(var r in e)a+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])+"&";return a}var conf=1,tokens=token(),orderList_url=["../assets/data/orderList.json",baseUrl()+"member.php?r=order&m=index&token="+token()],deleteOrder=["../assets/data/orderList.json",baseUrl()+"member.php?r=order&m=deleteOrder"],cancelOrder=["../assets/data/orderList.json",baseUrl()+"member.php?r=order&m=cancel"],cuidanOrder=["../assets/data/orderList.json",baseUrl()+"member.php?r=order&m=reminder"],shOrder=["../assets/data/orderList.json",baseUrl()+"member.php?r=order&m=confirmReceipt"],tuikuan=["../assets/data/orderList.json",baseUrl()+"member.php?r=order&m=refund"],orderpay=["../assets/data/orderList.json",baseUrl()+"index.php?r=pay&m=orderPay"],cnyPay=baseUrl()+"index.php?r=pay&m=orderPay",openid=Cache.get("openid"),mm="",isFrist=!1;window.onload=function(){var e=new Swiper("#orderTable",{speed:500,onSlideChangeStart:function(e){switch($(".myOrder-tab .active").removeClass("active"),$(".myOrder-tab a").eq(e.activeIndex).addClass("active"),e.activeIndex){case 0:mm="";break;case 1:mm="&state=10";break;case 2:mm="&state=20";break;case 3:mm="&state=30";break;case 4:mm="&state=40"}orderList.showView()}});$(".myOrder-tab a").on("touchstart mousedown",function(a){a.preventDefault(),$(".myOrder-tab .active").removeClass("active"),$(this).addClass("active"),e.slideTo($(this).index())}),$(".myOrder-tab a").click(function(e){e.preventDefault()})};var header={"content-type":"application/x-www-form-urlencoded"},orderList=new Vue({el:"#orderTable",data:{orderList:[],orderId:"",flag:!0,loadingFlag:!0},mounted:function(){this.showView()},methods:{showView:function(e){var a=this;axios.get(orderList_url[conf]+mm).then(function(e){var r=e.data;orderList.orderList=r,"1"==r.res&&(a.loadingFlag=!1)})},cancelOrder:function(e,a){axios.get(cancelOrder[conf],{params:{token:tokens,id:e}}).then(function(e){1==e.data.res?($.toast("取消订单成功"),$(a).addClass("btn-cancelhui"),$(a).closest(".ccart-list").remove()):$.toast("取消订单失败")})},tuikuanOrder:function(e,a){axios.get(tuikuan[conf],{params:{token:tokens,id:e}}).then(function(a){var r=a.data;console.log(r),1==r.res?setTimeout(function(){window.location.href="./moneyBack.html?order_id="+e},1e3):$.toast(msg)})},deleteOrder:function(e,a){axios.get(deleteOrder[conf],{params:{token:tokens,id:e}}).then(function(e){1==e.data.res?($.toast("删除订单成功"),$(a).closest(".ccart-list").remove()):$.toast("删除订单失败")})},shOrder:function(e){axios.get(shOrder[conf],{params:{token:tokens,id:e}}).then(function(a){var r=a.data;$.toast(r.msg),1==r.res&&setTimeout(function(){window.location.href="./addComment.html?order_id="+e},1e3)})},cuidanOrder:function(e){axios.get(cuidanOrder[conf],{params:{token:tokens,id:e}}).then(function(e){var a=e.data;$.toast(a.msg)})},coventOrder:function(e){openid&&isWenxin?axios.post(cnyPay,transformRequest({token:token(),orderIds:e}),{headers:header}).then(function(e){console.log(e.data);var a=e.data.res,r=e.data.data.orderId,t=(e.data.data.amount,e.data.data.subject);1==a?FUQIANLA.init({appId:"VWT0GaNzbX3Dqesop5zrOg",merchId:"m1610030006",orderId:r,channel:"wx_pay_pub",amount:"0.01",subject:t,notifyUrl:"http://my.shop.7cai.tv/pay.php",extra:{openid:openid,cb:function(){window.location.href="./myOrder-table.html"}}}):$.toast("暂无法支付!")}):isWenxin&&!openid?$.toast("没有获取到用户ID!"):$.toast("请在微信中支付！")}}});$(".order-sub-box").on("click",".btn-cancelOrder",function(){var e=this;layer.open({content:"确定取消订单吗？",btn:["确定","取消"],yes:function(a){var r=$(e).parent().attr("id");orderList.cancelOrder(r,e),layer.close(a)}}),$(".layui-m-anim-scale").addClass("searchAera"),$(".layui-m-layerbtn").addClass("searchTop"),$(".layui-m-layercont").addClass("searchConfirm"),$(".layui-m-layerbtn span[no]").addClass("searchCancel"),$(".layui-m-layerbtn span[yes]").addClass("ok")}),$(".order-sub-box").on("click",".btn-cuiOrder",function(){var e=this,a=$(e).parent().attr("id");orderList.cuidanOrder(a,e)}),$(".order-sub-box").on("click",".btn-delOrder",function(e){var a=this;layer.open({content:"确定删除订单吗？",btn:["确定","取消"],yes:function(e){var r=$(a).parent().attr("id");orderList.deleteOrder(r,a),layer.close(e)}}),$(".layui-m-anim-scale").addClass("searchAera"),$(".layui-m-layerbtn").addClass("searchTop"),$(".layui-m-layercont").addClass("searchConfirm"),$(".layui-m-layerbtn span[no]").addClass("searchCancel"),$(".layui-m-layerbtn span[yes]").addClass("ok")}),$(".order-sub-box").on("click",".btn-shouhuo",function(){var e=$(this).parent().attr("id");-1==$(this).parent().parent().find(".tuikaun").text().trim().indexOf("退款中")?($.toast("确认收货成功"),orderList.shOrder(e)):(layer.open({content:"该订单正在申请退款中，确认收货将关闭退款。",btn:["确定","取消"],yes:function(a){orderList.shOrder(e),layer.close(a)}}),$(".layui-m-anim-scale").addClass("popupTitleBox"),$(".layui-m-layerbtn").addClass("popupBottom"),$(".layui-m-layercont").addClass("popupTitle"),$(".layui-m-layerbtn span[no]").addClass("cancel"),$(".layui-m-layerbtn span[yes]").addClass("sure"))}),$(".order-sub-box").on("click",".btn-tuikuan",function(){var e=$(this).parent().attr("id"),a=this;orderList.tuikuanOrder(e,a)}),$(".order-sub-box").on("click",".btn-commentOrder",function(){}),$(".order-sub-box").on("click",".btn-duihuan",function(){var e=$(this).parent().attr("id");orderList.coventOrder(e)});