function GetQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(e);return null!=o?unescape(o[2]):null}function transformRequest(t){var e="";for(var o in t)e+=encodeURIComponent(o)+"="+encodeURIComponent(t[o])+"&";return e}function unscape(t){return t.replace(t?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")}var conf=1,tokens=token(),shopList=["",baseUrl()+"index.php?r=Goods&m=goods&id="],goodShopList=["",baseUrl()+"index.php?r=Goods&m=business&id="],evaluateList=["",baseUrl()+"index.php?r=Comment&m=index&goods_id="],coventList=["",baseUrl()+"member.php?r=Fav_goods&m=selectfav"],collectList=["",baseUrl()+"member.php?r=Fav_goods&m=addfav"],delCollectList=["",baseUrl()+"member.php?r=Fav_goods&m=delfav"],addCartList=["",baseUrl()+"index.php?r=cart&m=add"],normList=["../assets/data/goodsRule.json",baseUrl()+"index.php?r=Goods&m=get_det_attr"],platformList=["",baseUrl()+"index.php?r=Discount_coupon&m=getAdminCoupon"],platform=["",baseUrl()+"index.php?r=User_discount_coupon&m=addUserCoupon"],shopCouponList=["",baseUrl()+"index.php?r=Discount_coupon&m=getShopCoupon"],platformCoupons=["../assets/data/platformCoupon.json",""],shopCoupons=["../assets/data/shopCoupon.json",""],header={"content-type":"application/x-www-form-urlencoded"},orderID=GetQueryString("id"),goodsDatail=new Vue({el:"#goods-datail",data:{datail:[],shop:[],Comment:[],keep:"icon-shoucang",keepId:""},mounted:function(){this.showGoods(),this.$nextTick(function(){this.swiper(),this.swiper2()})},methods:{swiper2:function(){var t=new Swiper("#tabs-container",{speed:100,onSlideChangeStart:function(t){$(".buttons-tab  .active").removeClass("active"),$(".buttons-tab a").eq(t.activeIndex).addClass("active")}});$(".goodsDetail-tab a").on("click",function(e){e.preventDefault(),$(".goodsDetail-tab .active").removeClass("active"),$(this).addClass("active"),t.slideTo($(this).index())}),$(".goodsDetail-tab a").click(function(t){t.preventDefault()})},swiper:function(){new Swiper("#goodsDetailBanner",{pagination:".swiper-pagination",autoplayDisableOnInteraction:!1,observer:!0,observeParents:!0})},showGoods:function(){axios.get(shopList[conf]+orderID).then(function(t){var e=t.data.data;goodsDatail.datail=e,goodsDatail.datail.content=unscape(goodsDatail.datail.content),$("#goods_id").val(e.id)}),axios.get(goodShopList[conf]+orderID).then(function(t){var e=t.data.data;goodsDatail.shop=e}),axios.get(evaluateList[conf]+orderID).then(function(t){var e=t.data.data;1===t.data.res&&(goodsDatail.Comment=e)}),axios.get(coventList[conf]+"&goodsId="+orderID,{params:{token:tokens}}).then(function(t){var e=t.data.data;1==t.data.res&&($(".detail-col i").addClass("icon-yishoucang2"),goodsDatail.keepId=e)})},showGoodRule:function(){$(document).on("click",".open-rule",function(){$.popup("#popup-rule"),goodRule.showParameterRule()})},clickKeep:function(t){""==t?axios.post(collectList[conf],transformRequest({token:token(),goodsId:orderID}),{headers:header}).then(function(t){var e=t.data.res,o=t.data.data;t.data.msg;1==e?($(".detail-col i").addClass("icon-shoucang")&&($(".detail-col i").addClass("icon-yishoucang2"),$(".detail-col i").removeClass("icon-shoucang"),$(".detail-col p").text("已收藏")),goodsDatail.keepId=o,layer.open({content:"收藏成功",skin:"msg",time:2})):1==o&&(layer.open({content:"您还没有登录,请登录!",skin:"msg",time:2}),window.location.href="http://v.7cai.tv/templets/gerenzhongxin/login/login.html")}):axios.post(delCollectList[conf],transformRequest({token:tokens,id:t}),{headers:header}).then(function(t){var e=t.data.res;goodsDatail.keepId="";var o=t.data.msg;1==e?(goodsDatail.keep="icon-shoucang",$(".detail-col i").addClass("icon-yishoucang2")&&($(".detail-col i").addClass("icon-shoucang"),$(".detail-col i").removeClass("icon-yishoucang2"),$(".detail-col p").text("收藏")),layer.open({content:"已取消收藏",skin:"msg",time:2})):layer.open({content:o,skin:"msg",time:2})})},addShoping:function(t){if(1==t){var e=!0,o="";if($(".ruleClass b").each(function(t,n){if(""==$(n).text())return layer.open({content:"请选择"+$(n).attr("data-val"),skin:"msg",time:2}),e=!1,!1;""==o?o=$(n).attr("attrId"):o+=","+$(n).attr("attrId")}),e){var n=$("#goods_id").val(),a=$("#goods_number").val();axios.post(addCartList[conf],transformRequest({token:tokens,goods_id:n,attr:o,number:a,fast:0}),{headers:header}).then(function(t){var e=t.data.res,o=t.data.msg;t.data.data;1==e?layer.open({content:"商品已加入购物车, </br> 赶紧把它抱回家吧~",skin:"msg",time:2}):"请先登录！"==o?(layer.open({content:"您还没有登录,请登录!",skin:"msg",time:2}),setTimeout(function(){window.location.href="http://v.7cai.tv/templets/gerenzhongxin/login/login.html"},1e3)):"属性选择错误"==o?layer.open({content:"请选择样式!",skin:"msg",time:2}):layer.open({content:o,skin:"msg",time:2})})}}else if(0==t){var e=!0,o="";if($(".ruleClass b").each(function(t,n){if(""==$(n).text())return layer.open({content:"请选择"+$(n).attr("data-val"),skin:"msg",time:2}),e=!1,!1;""==o?o=$(n).attr("attrId"):o+=","+$(n).attr("attrId")}),e){var n=$("#goods_id").val(),a=$("#goods_number").val();axios.post(addCartList[conf],transformRequest({token:tokens,goods_id:n,attr:o,number:a,fast:1}),{headers:header}).then(function(t){var e=t.data.res,o=t.data.msg,n=t.data.data;1==e?window.location.href="./confirmOrder.html?attr="+n:"请先登录！"==o?(layer.open({content:"您还没有登录,请登录!",skin:"msg",time:2}),setTimeout(function(){window.location.href="http://v.7cai.tv/templets/gerenzhongxin/login/login.html"},1e3)):layer.open({content:o,skin:"msg",time:2})})}}}}}),goodRule=new Vue({el:"#popup-rule",data:{parameterRule:[],quantity:1,imgSrc:"",imageSrc:""},mounted:function(){$(document).on("click",".popup-overlay",function(){var t=$(".ruleClass").text();$(".item-size").text(t)})},methods:{showParameterRule:function(){axios.get(normList[conf]+"&goodsId="+orderID).then(function(t){var e=t.data.data;goodRule.parameterRule=e,""==goodRule.imgSrc&&(goodRule.imgSrc=e.goods_thumb,goodRule.imageSrc=e.goods_thumb)})},selectRule:function(t,e,o,n,a,i){var s=this;$('li[data-pub="'+n+'"]').removeClass("active"),$('li[data_ID="'+i+'"]').addClass("active"),$("."+n).html(t+" "),$("."+n).attr("attrId",i),s.imgSrc=null==a||""==a?s.imageSrc:a},changeNum:function(t,e){var o,n;e>0?goodRule.quantity==t.goods_number?(goodRule.quantity,t.goods_number,layer.open({content:"选择数量大于库存数量",skin:"msg",time:2})):(goodRule.quantity++,o=t.sell_price*goodRule.quantity,n=t.money*goodRule.quantity,$(".r-qicai em").text(o),$(".r-rmb em").text(n)):(goodRule.quantity--,o=t.sell_price*goodRule.quantity,n=t.money*goodRule.quantity,$(".r-qicai em").text(o),$(".r-rmb em").text(n),goodRule.quantity<1&&(goodRule.quantity=1,o=t.sell_price*goodRule.quantity,n=t.money*goodRule.quantity,$(".r-qicai em").text(o),$(".r-rmb em").text(n))),$("#goods_number").val(goodRule.quantity)},selectFinish:function(){var t=!0,e="";if($(".ruleClass b").each(function(o,n){if(""==$(n).text())return layer.open({content:"请选择"+$(n).attr("data-val"),skin:"msg",time:2}),t=!1,!1;""==e?e=$(n).attr("attrId"):e+=","+$(n).attr("attrId")}),t){var o=$("#goods_id").val(),n=$("#goods_number").val();axios.post(addCartList[conf],transformRequest({token:tokens,goods_id:o,attr:e,number:n,fast:0}),{headers:header}).then(function(t){var e=t.data.res,o=t.data.msg;if(1==e){$.closeModal(".popup-about"),layer.open({content:"商品已加入购物车, </br> 赶紧把它抱回家吧~",skin:"msg",time:2});var n=$(".ruleClass").text();$(".item-size").text(n)}else"请先登录！"==o?(layer.open({content:"您还没有登录,请登录!",skin:"msg",time:2}),setTimeout(function(){window.location.href="http://v.7cai.tv/templets/gerenzhongxin/login/login.html"},1e3)):layer.open({content:o,skin:"msg",time:2})})}},selectConvert:function(){var t=!0,e="";if($(".ruleClass b").each(function(o,n){if(""==$(n).text())return layer.open({content:"请选择"+$(n).attr("data-val"),skin:"msg",time:2}),t=!1,!1;""==e?e=$(n).attr("attrId"):e+=","+$(n).attr("attrId")}),t){var o=$("#goods_id").val(),n=$("#goods_number").val();axios.post(addCartList[conf],transformRequest({token:tokens,goods_id:o,attr:e,number:n,fast:1}),{headers:header}).then(function(t){var e=t.data.res,o=t.data.msg,n=t.data.data;1==e?window.location.href="./confirmOrder.html?attr="+n:"请先登录！"==o?(layer.open({content:"您还没有登录,请登录!",skin:"msg",time:2}),setTimeout(function(){window.location.href="http://v.7cai.tv/templets/gerenzhongxin/login/login.html"},1e3)):layer.open({content:o,skin:"msg",time:2})})}},finishClose:function(){var t=$(".ruleClass").text();$(".item-size").text(t)}}}),platformCoupon=new Vue({el:".popup-stageticket",data:{platformCouponList:[],platformStatus:"",platform:""},filters:{couponsMoney:function(t,e){return 2==e?"￥"+t:1==e?"七彩币"+t:void 0},receiveStatus1:function(t){return value=1==t?"已领取":"领券"}},mounted:function(){var t=this;$(document).on("click",".open-stageticket",function(){$.popup(".popup-stageticket"),t.showCoupon()})},methods:{showCoupon:function(){axios.post(platformList[conf],transformRequest({token:tokens})).then(function(t){var e=t.data;platformCoupon.platformCouponList=e,0==e.res&&$(".gd-box").hide()})},receiveCoupons:function(t){"领券"==$("#"+t).html()&&axios.post(platform[conf],transformRequest({token:tokens,discount_coupon_id:t}),{headers:header}).then(function(e){var o=e.data.res,n=e.data.msg;if(1==o){$("#"+t).html("已领取"),layer.open({content:"成功领取优惠券",skin:"msg",time:2});var a=$("#"+t).parent().find(".price span").html();$(".item-nump").text(a)}else layer.open({content:n,skin:"msg",time:2})})}}}),shopCoupon=new Vue({el:".popup-shopticket",data:{shopCouponList:[]},filters:{couponsMoney:function(t,e){return 2==e?"￥"+t:1==e?"七彩币"+t:void 0},receiveStatus:function(t){return value=1==t?"已领取":"领券"}},mounted:function(){var t=this;$(document).on("click",".open-shopticket",function(){$.popup(".popup-shopticket"),t.showShopCoupon()})},methods:{showShopCoupon:function(){var t=$(".userInfo").attr("shop_id");axios.post(shopCouponList[conf],transformRequest({token:tokens,shop_id:t})).then(function(t){var e=t.data;shopCoupon.shopCouponList=e,0==e.res&&$(".gd-box").hide()})},receiveCoupons:function(t){"领券"==$("#"+t).html()&&axios.post(platform[conf],transformRequest({token:tokens,discount_coupon_id:t}),{headers:header}).then(function(e){var o=e.data.res,n=e.data.msg;if(1==o){$("#"+t).html("已领取"),layer.open({content:"成功领取优惠券",skin:"msg",time:2});var a=$("#"+t).parent().find(".price span").html();$(".item-num").text(a)}else layer.open({content:n,skin:"msg",time:2})})}}});$(".fixed-wrap").on("click",".buttons-tab",function(t){var e=$(".buttons-tab").offset().top,o=$(".native-scroll").offset().top,n=$(".native-scroll").scrollTop(),a=$(".buttons-tab").height();e>o&&$(".native-scroll").scrollTo({toT:e+n-a})}),$.init();