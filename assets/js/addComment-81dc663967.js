function getQueryString(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(n);return null!=t?unescape(t[2]):null}function transformRequest(e){var n="";for(var t in e)n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t])+"&";return n}var tokens=token(),oHeight=$(document).height();$(window).resize(function(){$(document).height()<oHeight?$("#commentBtn").css("position","static"):$("#commentBtn").css("position","fixed")});var orderGoods=getQueryString("order_goods");$("#token").val(token());var header={"content-type":"application/x-www-form-urlencoded"};$(".btn-cancelOrder").on("click",function(){layer.open({content:"确定取消发布评论吗？",btn:["确定","取消"],yes:function(e){window.history.go(-1),layer.close(e)}}),$(".layui-m-anim-scale").addClass("searchAera"),$(".layui-m-layerbtn").addClass("searchTop"),$(".layui-m-layercont").addClass("searchConfirm"),$(".layui-m-layerbtn span[no]").addClass("searchCancel"),$(".layui-m-layerbtn span[yes]").addClass("ok")}),new Vue({el:"#comment",data:{imgSrc:[],imgNum:"最多三张",goods:[]},mounted:function(){this.showView()},methods:{showView:function(){var e=this;axios.get(baseUrl()+"member.php?r=order_goods&m=getOrderGoods&ids="+orderGoods+"&token="+token()).then(function(n){var t=n.data;e.goods=t.data})},changeImg:function(e){var n=e.target.files||e.dataTransfer.files;n.length&&this.createImage(n[0])},createImage:function(e){var n=this,t=new FileReader;t.readAsDataURL(e),t.onload=function(e){n.imgSrc.push(e.target.result)},this.imgNum=this.imgSrc.length+1+"/3"},remove:function(e){this.imgSrc.splice(e,1),$("#upload").val(""),0==this.imgSrc.length?this.imgNum="最多三张":this.imgNum=this.imgSrc.length+"/3"},sub:function(){if(""==$(".comment").val())layer.open({content:"请填写商品评价",skin:"msg",time:2});else{var e=$("form[name=fileForm]"),n={url:baseUrl()+"index.php?r=comment&m=add&",type:"post",success:function(e){1==e.res?(layer.open({content:"发表成功",skin:"msg",time:2}),window.history.go(-1)):layer.open({content:"发表失败",skin:"msg",time:2})}};e.ajaxSubmit(n)}}}});